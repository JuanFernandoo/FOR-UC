<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Clone</title>
    <link rel="stylesheet" href="/src/CSS/index.css">
</head>

<body>
    <header>
        <div id="header-text">
          <h1>FOR-UC</h1>
        </div>
        <div id="search-bar">
          <input type="text" placeholder="Buscar" class="search-bar">
        </div>
        <div id="header-img">
            <button class="nav-button" id="createPostBtn"><img src="/public/IMG/new-post-48.png" alt="new post"></button>
            <a href="/public/Login.html"><img src="/public/IMG/usuario-50.png" alt="User"></a>
        </div>
      </header>
    <div class="main-content">
        <aside class="sidebar">
            <a href="#" class="sidebar-item">üè† Home</a>
            <hr style="border-color: #343536;">
            <h4 style="color: #818384; font-size: 12px;">COMUNIDADES</h4>
            <a href="#" class="sidebar-item" id="createCommunityBtn">+ Crear una comunidad</a>
        </aside>
        
        <main class="content" id="mainContent">
            <div class="post_de_bienvenida">
            <div class="post-bienvenida-title">HOLA!  Que bueno es tenerte aca ;)</div>
            <div class="post-bienvenida-content">
                <p>Donde las Ideas Universitarias Cobran Vida √önete a una comunidad de estudiantes donde cada tema, acad√©mico o casual, tiene su espacio. ¬°Comparte, aprende y conecta con otros!</p>
                <img src="/public/IMG/goku-6028390_640.png" alt="meme_goku_calvo" class="imagen_bienvenida">
            </div>
            <div class="post">
            
        </main>
    </div>

    <div id="createPostModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Subir una publicacion</h2>
            <form id="createPostForm">
                <input type="text" id="postTitle" placeholder="Titulo" required>
                <textarea id="postContent" placeholder="Contenido" required></textarea>
                <input type="text" id="postImage" placeholder="Image URL (optional)">
                <button type="submit">Publicar</button>
            </form>
        </div>
    </div>

    <div id="createCommunityModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Crear una comunidad</h2>
            <form id="createCommunityForm">
                <input type="text" id="communityName" placeholder="Nombre de la comunidad" required>
                <textarea id="communityDescription" placeholder="Descripcion" required></textarea>
                <button type="submit">Crear comunidad</button>
            </form>
        </div>
    </div>
    <footer class="footer">
        <p>Authors: Juan Fernando Orjuela | Milton Andres Novoa Gutierrez | Maria Fernando Sierra Serna</p>
        <p>¬©2024</p>
      </footer>
    <script>
        let posts = JSON.parse(localStorage.getItem('posts')) || [];
        let communities = JSON.parse(localStorage.getItem('communities')) || [];

        function saveData() {
            localStorage.setItem('posts', JSON.stringify(posts));
            localStorage.setItem('communities', JSON.stringify(communities));
        }

        function createPost(title, content, imageUrl, community) {
            const newPost = {
                id: Date.now(),
                title,
                content,
                imageUrl,
                community,
                author: 'Anonymous',
                votes: 0,
                comments: [],
                createdAt: new Date().toISOString()
            };
            posts.unshift(newPost);
            saveData();
            renderPosts();
        }

        // Function to create a new community
        function createCommunity(name, description) {
            const newCommunity = {
                id: Date.now(),
                name,
                description,
                createdAt: new Date().toISOString()
            };
            communities.push(newCommunity);
            saveData();
        }

        // Function to add a comment to a post
        function addComment(postId, content) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.comments.push({
                    id: Date.now(),
                    content,
                    author: 'Anonymous',
                    createdAt: new Date().toISOString()
                });
                saveData();
                renderPosts();
            }
        }

        // Function to render posts
        function renderPosts() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = '';
            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post';
                postElement.innerHTML = `
                    <div class="post-header">
                        <img src="/public/IMG/icon-user-black.png" alt="Sub Icon" class="sub-icon">
                        <span style="font-weight: bold; margin-right: 4px;">r/${post.community}</span>
                        <span style="color: #818384; font-size: 12px;">‚Ä¢ Posted by u/${post.author} ${new Date(post.createdAt).toLocaleString()}</span>
                    </div>
                    <h2 class="post-title">${post.title}</h2>
                    <p>${post.content}</p>
                    ${post.imageUrl ? `<img src="${post.imageUrl}" alt="Post Image" class="post-image">` : ''}
                    <div class="post-footer">
                        <div class="vote-buttons">
                            <button class="vote-button" onclick="vote(${post.id}, 1)">‚¨ÜÔ∏è</button>
                            <span id="votes-${post.id}">${post.votes}</span>
                            <button class="vote-button" onclick="vote(${post.id}, -1)">‚¨áÔ∏è</button>
                        </div>
                        <button class="nav-button" onclick="toggleComments(${post.id})">üí¨ ${post.comments.length} Comments</button>
                    </div>
                    <div id="comments-${post.id}" class="comments-section" style="display: none;">
                        ${post.comments.map(comment => `
                            <div class="comment">
                                <p>${comment.content}</p>
                                <small>Posted by ${comment.author} on ${new Date(comment.createdAt).toLocaleString()}</small>
                            </div>
                        `).join('')}
                        <form onsubmit="event.preventDefault(); addComment(${post.id}, this.newComment.value); this.newComment.value = '';">
                            <input type="text" name="newComment" placeholder="A√±adir comentario" required>
                            <button type="submit">Comment</button>
                        </form>
                    </div>
                `;
                mainContent.appendChild(postElement);
            });
        }

        // Function to handle voting
        function vote(postId, value) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.votes += value;
                saveData();
                document.getElementById(`votes-${postId}`).textContent = post.votes;
            }
        }

        // Function to toggle comments visibility
        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
        }

        // Event listeners for modals
        document.getElementById('createPostBtn').addEventListener('click', () => {
            document.getElementById('createPostModal').style.display = 'block';
        });

        document.getElementById('createCommunityBtn').addEventListener('click', () => {
            document.getElementById('createCommunityModal').style.display = 'block';
        });

        // Close modals when clicking on the close button or outside the modal
        document.querySelectorAll('.close, .modal').forEach(element => {
            element.addEventListener('click', (event) => {
                if (event.target === element) {
                    element.closest('.modal').style.display = 'none';
                }
            });
        });

        // Handle form submissions
        document.getElementById('createPostForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const imageUrl = document.getElementById('postImage').value;
            createPost(title, content, imageUrl, 'general');
            document.getElementById('createPostModal').style.display = 'none';
            e.target.reset();
        });

        document.getElementById('createCommunityForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('communityName').value;
            const description = document.getElementById('communityDescription').value;
            createCommunity(name, description);
            document.getElementById('createCommunityModal').style.display = 'none';
            e.target.reset();
        });

        // Initial render
        renderPosts();
    </script>
</body>

</html>